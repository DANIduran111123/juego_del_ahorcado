<!doctype html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ahorcado CANVAS</title>
<style>
body{
  width:960px;
  margin:0 auto;
  background:#e9f5ee;
}

h1{
  text-align:center;
  color:#222;
}
#miCanvas{
  border:dotted 2px yellow;
  background:green; 
  border-radius:8px;
}
button{
  display:block;
  margin:20px auto;
  padding:10px 20px;
  font-size:16px;
  border-radius:5px;
  border:none;
  background:#4CAF50;
  color:white;
  cursor:pointer;
}
button:hover{
  background:#45a049;
}
</style>
<script>
/*** Variables ***/
var ctx, canvas;
var palabra;
var letras = "QWERTYUIOPASDFGHJKLÃ‘ZXCVBNM";
var colorTecla = "purple";
var colorMargen = "yellow";
var inicioX = 200;
var inicioY = 300;
var lon = 35;
var margen = 20;

// Arreglos y control
var teclas_array = [];
var letras_array = [];
var palabras_array = ["PEGASO","AFRODITA","ATENEA","ARES","CRONOS","HERMES","DIONISIO","PERSEO","POSEIDON","APOLO"];
var aciertos = 0;
var errores = 0;

/*** Objetos ***/
function Tecla(x,y,ancho,alto,letra){
  this.x=x; this.y=y; this.ancho=ancho; this.alto=alto; this.letra=letra;
  this.dibuja = function(){
    ctx.fillStyle = colorTecla;
    ctx.strokeStyle = colorMargen;
    ctx.fillRect(this.x, this.y, this.ancho, this.alto);
    ctx.strokeRect(this.x, this.y, this.ancho, this.alto);
    ctx.fillStyle = "white";
    ctx.font = "bold 20px Courier";
    ctx.fillText(this.letra, this.x+this.ancho/2-6, this.y+this.alto/2+6);
  }
}

function Letra(x,y,ancho,alto,letra){
  this.x=x; this.y=y; this.ancho=ancho; this.alto=alto; this.letra=letra;
  this.dibuja = function(){
    ctx.fillStyle = "white";
    ctx.strokeStyle = "black";
    ctx.fillRect(this.x, this.y, this.ancho, this.alto);
    ctx.strokeRect(this.x, this.y, this.ancho, this.alto);
  }
  this.dibujaLetra = function(){
    ctx.fillStyle = "black";
    ctx.font = "bold 40px Courier";
    ctx.fillText(this.letra, this.x+this.ancho/2-12, this.y+this.alto/2+14);
  }
}

/*** Funciones principales ***/
function teclado(){
  var ren=0, col=0, letra="", miLetra, x=inicioX, y=inicioY;
  for(var i=0;i<letras.length;i++){
    letra = letras.substr(i,1);
    miLetra = new Tecla(x,y,lon,lon,letra);
    miLetra.dibuja();
    teclas_array.push(miLetra);
    x += lon + margen;
    col++;
    if(col==10){col=0;ren++;y=inicioY+ren*50;x=(ren==2)?280:inicioX;}
  }
}

function pintaPalabra(){
  var p = Math.floor(Math.random()*palabras_array.length);
  palabra = palabras_array[p];
  var y = 230;
  var x = (canvas.width - (50+margen)*palabra.length)/2;
  for(var i=0;i<palabra.length;i++){
    var letra = palabra.substr(i,1);
    var miLetra = new Letra(x,y,50,50,letra);
    miLetra.dibuja();
    letras_array.push(miLetra);
    x += 50 + margen;
  }
}

function cadalso(errores){
  var imagen = new Image();
  imagen.src = "imagenes/ahorcado" + errores + ".png";
  imagen.onload = function(){
    ctx.drawImage(imagen,390,20,180,180); 
  }
}

function ajusta(xx,yy){
  var posCanvas = canvas.getBoundingClientRect();
  return {x: xx - posCanvas.left, y: yy - posCanvas.top};
}

function selecciona(e){
  var pos = ajusta(e.clientX, e.clientY);
  var x=pos.x, y=pos.y, tecla, bandera=false;
  for(var i=0;i<teclas_array.length;i++){
    tecla = teclas_array[i];
    if(tecla.x>0){
      if((x>tecla.x)&&(x<tecla.x+tecla.ancho)&&(y>tecla.y)&&(y<tecla.y+tecla.alto)){
        break;
      }
    }
  }
  if(i<teclas_array.length){
    for(var j=0;j<palabra.length;j++){
      var letra = palabra.substr(j,1);
      if(letra==tecla.letra){
        var caja = letras_array[j];
        caja.dibujaLetra();
        aciertos++;
        bandera=true;
      }
    }
    if(!bandera){
      errores++;
      cadalso(errores);
      if(errores==5) gameOver(false);
    }
    ctx.clearRect(tecla.x-1,tecla.y-1,tecla.ancho+2,tecla.alto+2);
    tecla.x=-1;
    if(aciertos==palabra.length) gameOver(true);
  }
}

function gameOver(ganado){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="black";
  ctx.font="bold 45px Courier";
  if(ganado){
    ctx.fillText("Â¡Muy bien! La palabra era:",110,260);
  }else{
    ctx.fillText("Lo sentimos, la palabra era:",80,260);
  }
  ctx.font="bold 80px Courier";
  var lonTexto=(canvas.width-(palabra.length*48))/2;
  ctx.fillText(palabra,lonTexto,380);
  cadalso(errores);
}

function iniciar(){
  canvas=document.getElementById("miCanvas");
  ctx=canvas.getContext("2d");
  teclas_array=[]; letras_array=[]; aciertos=0; errores=0;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  teclado();
  pintaPalabra();
  cadalso(errores);
  canvas.addEventListener("click",selecciona,false);
}

window.onload=iniciar;
</script>
</head>
<body>
<h1>ðŸŽ¨ Juego del Ahorcado</h1>
<canvas id="miCanvas" width="960" height="450">Tu navegador no soporta CANVAS</canvas>
<button onclick="iniciar()">Nuevo Juego</button>
</body>
</html>